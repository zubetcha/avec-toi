"use client";

import React from "react";
import { useInvitationStore } from "../stores/invitation-store";
import Image from "next/image";

export default function InvitationPreview() {
  const { data } = useInvitationStore();

  // Ïã†Îûë, Ïã†Î∂Ä Ïù¥Î¶Ñ Ï°∞Ìï©
  const groomFullName = `${data.groomInfo.lastName}${data.groomInfo.firstName}`;
  const brideFullName = `${data.brideInfo.lastName}${data.brideInfo.firstName}`;

  // Ï†úÎ™© ÏÉùÏÑ± (ÏûÖÎ†•Îêú Ï†úÎ™©Ïù¥ ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∏∞Î≥∏Í∞í)
  const displayTitle =
    data.title ||
    (groomFullName && brideFullName
      ? `${groomFullName}‚ô•${brideFullName} Í≤∞ÌòºÏãùÏóê Ï¥àÎåÄÌï©ÎãàÎã§`
      : "Í≤∞ÌòºÏãùÏóê Ï¥àÎåÄÌï©ÎãàÎã§");

  // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
  const formattedDate = data.weddingDate
    ? new Date(data.weddingDate).toLocaleDateString("ko-KR", {
        year: "numeric",
        month: "long",
        day: "numeric",
        weekday: "long",
      })
    : "";

  // ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖ
  const formattedTime = data.weddingTime
    ? `${data.weddingTime.split(":")[0]}Ïãú ${data.weddingTime.split(":")[1]}Î∂Ñ`
    : "";

  // Ïû•ÏÜå ÌëúÏãú
  const displayVenue = data.venueHall
    ? `${data.weddingLocation} ${data.venueHall}`
    : data.weddingLocation;

  // Î∂ÄÎ™®Îãò Ïù¥Î¶Ñ ÌëúÏãú (Í≥†Ïù∏ Ï≤òÎ¶¨ Ìè¨Ìï®)
  const getParentName = (name: string, isDeceased: boolean) => {
    if (!name) return "";
    return isDeceased && data.options.showDeceasedWithFlower ? `üåπ ${name}` : name;
  };

  return (
    <div className="flex h-full w-full flex-col overflow-hidden rounded-md bg-white shadow-[0_4px_16px_0px_rgba(17,17,26,0.03),0_8px_32px_0px_rgba(17,17,26,0.03)]">
      <div
        className="scrollbar-hide flex-1 overflow-auto"
        style={{
          backgroundColor: data.backgroundColor,
          fontFamily: data.theme.selectedFont,
          fontSize:
            data.theme.selectedFontSize === "small"
              ? "14px"
              : data.theme.selectedFontSize === "large"
                ? "18px"
                : "16px",
          WebkitOverflowScrolling: "touch",
          msOverflowStyle: "none",
          scrollbarWidth: "none",
        }}
      >
        <style jsx>{`
          div::-webkit-scrollbar {
            display: none;
          }
        `}</style>
        {/* Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ */}
        <div className="flex h-full w-full items-center justify-center bg-gray-100">
          {data.mainImage ? (
            <Image
              src={data.mainImage}
              alt="Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ"
              width={100}
              height={100}
              className="h-full w-full object-cover"
            />
          ) : (
            <span className="text-gray-500">ÌÖúÌîåÎ¶ø {data.selectedThemeId}</span>
          )}
        </div>

        <div className="space-y-4 p-6">
          {/* Ï†úÎ™© */}
          <h2
            className="text-center text-xl font-medium"
            style={{ color: data.theme.selectedColor }}
          >
            {displayTitle}
          </h2>

          {/* ÎÇ†Ïßú Î∞è Ïû•ÏÜå */}
          <div className="space-y-1 text-center">
            {formattedDate && (
              <p className="text-sm text-gray-700">
                {formattedDate} {formattedTime}
              </p>
            )}
            {displayVenue && <p className="text-sm text-gray-700">{displayVenue}</p>}
            {data.weddingAddress && <p className="text-xs text-gray-500">{data.weddingAddress}</p>}
          </div>

          {/* Ïã†ÎûëÏã†Î∂Ä Ï†ïÎ≥¥ */}
          {(groomFullName || brideFullName) && (
            <div className="flex items-center justify-center gap-6 py-4">
              {/* Ïã†Î∂Ä Ïö∞ÏÑ† ÌëúÏãú ÏòµÏÖò Ï≤òÎ¶¨ */}
              {data.options.showBrideFirst ? (
                <>
                  {brideFullName && (
                    <div className="text-center">
                      <p className="font-medium">{brideFullName}</p>
                      <p className="text-xs text-gray-500">Ïã†Î∂Ä</p>
                      {(data.brideInfo.fatherName || data.brideInfo.motherName) && (
                        <div className="mt-1 text-xs text-gray-400">
                          {getParentName(
                            data.brideInfo.fatherName,
                            data.brideInfo.isFatherDeceased
                          )}
                          {data.brideInfo.fatherName && data.brideInfo.motherName && " ¬∑ "}
                          {getParentName(
                            data.brideInfo.motherName,
                            data.brideInfo.isMotherDeceased
                          )}
                          <span className="ml-1">
                            Ïùò {data.brideInfo.isChild === "son" ? "ÏïÑÎì§" : "Îî∏"}
                          </span>
                        </div>
                      )}
                    </div>
                  )}
                  {groomFullName && brideFullName && (
                    <div className="text-2xl text-gray-300">&</div>
                  )}
                  {groomFullName && (
                    <div className="text-center">
                      <p className="font-medium">{groomFullName}</p>
                      <p className="text-xs text-gray-500">Ïã†Îûë</p>
                      {(data.groomInfo.fatherName || data.groomInfo.motherName) && (
                        <div className="mt-1 text-xs text-gray-400">
                          {getParentName(
                            data.groomInfo.fatherName,
                            data.groomInfo.isFatherDeceased
                          )}
                          {data.groomInfo.fatherName && data.groomInfo.motherName && " ¬∑ "}
                          {getParentName(
                            data.groomInfo.motherName,
                            data.groomInfo.isMotherDeceased
                          )}
                          <span className="ml-1">
                            Ïùò {data.groomInfo.isChild === "son" ? "ÏïÑÎì§" : "Îî∏"}
                          </span>
                        </div>
                      )}
                    </div>
                  )}
                </>
              ) : (
                <>
                  {groomFullName && (
                    <div className="text-center">
                      <p className="font-medium">{groomFullName}</p>
                      <p className="text-xs text-gray-500">Ïã†Îûë</p>
                      {(data.groomInfo.fatherName || data.groomInfo.motherName) && (
                        <div className="mt-1 text-xs text-gray-400">
                          {getParentName(
                            data.groomInfo.fatherName,
                            data.groomInfo.isFatherDeceased
                          )}
                          {data.groomInfo.fatherName && data.groomInfo.motherName && " ¬∑ "}
                          {getParentName(
                            data.groomInfo.motherName,
                            data.groomInfo.isMotherDeceased
                          )}
                          <span className="ml-1">
                            Ïùò {data.groomInfo.isChild === "son" ? "ÏïÑÎì§" : "Îî∏"}
                          </span>
                        </div>
                      )}
                    </div>
                  )}
                  {groomFullName && brideFullName && (
                    <div className="text-2xl text-gray-300">&</div>
                  )}
                  {brideFullName && (
                    <div className="text-center">
                      <p className="font-medium">{brideFullName}</p>
                      <p className="text-xs text-gray-500">Ïã†Î∂Ä</p>
                      {(data.brideInfo.fatherName || data.brideInfo.motherName) && (
                        <div className="mt-1 text-xs text-gray-400">
                          {getParentName(
                            data.brideInfo.fatherName,
                            data.brideInfo.isFatherDeceased
                          )}
                          {data.brideInfo.fatherName && data.brideInfo.motherName && " ¬∑ "}
                          {getParentName(
                            data.brideInfo.motherName,
                            data.brideInfo.isMotherDeceased
                          )}
                          <span className="ml-1">
                            Ïùò {data.brideInfo.isChild === "son" ? "ÏïÑÎì§" : "Îî∏"}
                          </span>
                        </div>
                      )}
                    </div>
                  )}
                </>
              )}
            </div>
          )}

          {/* Î©îÏãúÏßÄ */}
          {data.message && (
            <div className="border-t border-b py-4 text-center text-sm leading-5 text-gray-600">
              {data.message.split("\n").map((line, index) => (
                <p key={index}>{line}</p>
              ))}
            </div>
          )}

          {/* Í∞§Îü¨Î¶¨ ÎØ∏Î¶¨Î≥¥Í∏∞ */}
          {data.galleryImages.length > 0 && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">Í∞§Îü¨Î¶¨</p>
              <div
                className={`grid gap-1 ${
                  data.galleryDisplayMode === "Í∑∏Î¶¨Îìú"
                    ? "grid-cols-3"
                    : data.galleryDisplayMode === "Î™®ÏûêÏù¥ÌÅ¨"
                      ? "grid-cols-2"
                      : "grid-cols-1"
                }`}
              >
                {data.galleryImages.slice(0, 6).map((image, index) => (
                  <div key={image.id} className="aspect-square overflow-hidden rounded bg-gray-100">
                    <Image
                      src={image.url}
                      alt={image.caption || `Í∞§Îü¨Î¶¨ Ïù¥ÎØ∏ÏßÄ ${index + 1}`}
                      width={120}
                      height={120}
                      className="h-full w-full object-cover"
                    />
                  </div>
                ))}
              </div>
              {data.galleryImages.length > 6 && (
                <p className="text-center text-xs text-gray-500">
                  +{data.galleryImages.length - 6}Í∞ú Îçî
                </p>
              )}
            </div>
          )}

          {/* ÎπÑÎîîÏò§ ÎØ∏Î¶¨Î≥¥Í∏∞ */}
          {data.video && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">ÎèôÏòÅÏÉÅ</p>
              <div className="rounded bg-gray-100 p-4 text-center">
                <p className="text-sm text-gray-600">
                  {data.video.type === "youtube" ? "YouTube" : "Ïª§Ïä§ÌÖÄ"} ÏòÅÏÉÅ
                </p>
                {data.video.title && (
                  <p className="mt-1 text-xs text-gray-500">{data.video.title}</p>
                )}
              </div>
            </div>
          )}

          {/* ÍµêÌÜµÌé∏ Ï†ïÎ≥¥ */}
          {data.transportations.some((t) => t.enabled && t.description) && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">Ïò§ÏãúÎäî Í∏∏</p>
              <div className="space-y-1">
                {data.transportations
                  .filter((t) => t.enabled && t.description)
                  .map((transport, index) => (
                    <div key={index} className="text-xs">
                      <span className="font-medium">{transport.type}:</span>
                      <span className="ml-1 text-gray-600">{transport.description}</span>
                    </div>
                  ))}
              </div>
            </div>
          )}

          {/* Ïó∞ÎùΩÏ≤ò ÎØ∏Î¶¨Î≥¥Í∏∞ */}
          {(data.contacts.groom.name || data.contacts.bride.name) && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">Ïó∞ÎùΩÏ≤ò</p>
              <div className="grid grid-cols-2 gap-2 text-xs">
                {data.contacts.groom.name && (
                  <div className="rounded bg-gray-50 p-2 text-center">
                    <p className="font-medium">Ïã†ÎûëÏ∏°</p>
                    <p>{data.contacts.groom.name}</p>
                    {data.contacts.groom.phoneNumber && (
                      <p className="text-gray-500">{data.contacts.groom.phoneNumber}</p>
                    )}
                  </div>
                )}
                {data.contacts.bride.name && (
                  <div className="rounded bg-gray-50 p-2 text-center">
                    <p className="font-medium">Ïã†Î∂ÄÏ∏°</p>
                    <p>{data.contacts.bride.name}</p>
                    {data.contacts.bride.phoneNumber && (
                      <p className="text-gray-500">{data.contacts.bride.phoneNumber}</p>
                    )}
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Í≥ÑÏ¢å Ï†ïÎ≥¥ */}
          {data.showBankAccounts && data.bankAccounts.length > 0 && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">ÎßàÏùå Ï†ÑÌïòÏã§ Í≥≥</p>
              <div className="space-y-1">
                {data.bankAccounts.map((account) => (
                  <div key={account.id} className="rounded bg-gray-50 p-2 text-xs">
                    <p className="font-medium">{account.relationship}</p>
                    <p>
                      {account.bankName} {account.accountNumber}
                    </p>
                    <p className="text-gray-500">{account.accountHolder}</p>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* ÏÑ†ÌÉùÎêú ÏùåÏïÖ */}
          {data.selectedSong && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">Î∞∞Í≤ΩÏùåÏïÖ</p>
              <div className="rounded bg-gray-50 p-2 text-xs">
                <p className="font-medium">{data.selectedSong.title}</p>
                <p className="text-gray-500">{data.selectedSong.artist}</p>
                {data.autoPlay && <p className="mt-1 text-xs text-blue-500">ÏûêÎèôÏû¨ÏÉù</p>}
              </div>
            </div>
          )}

          {/* Î∞©Î™ÖÎ°ù ÏÑ§Ï†ï */}
          {data.guestbookEnabled && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">Î∞©Î™ÖÎ°ù</p>
              <div className="rounded bg-gray-50 p-2 text-center text-xs">
                <p>Î∞©Î™ÖÎ°ùÏù¥ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§</p>
                {data.guestbookRequirePassword && (
                  <p className="mt-1 text-gray-500">ÎπÑÎ∞ÄÎ≤àÌò∏ ÌïÑÏöî</p>
                )}
                {data.guestbookModerationEnabled && (
                  <p className="mt-1 text-gray-500">Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌïÑÏöî</p>
                )}
              </div>
            </div>
          )}

          {/* ÌôîÌôò Ï£ºÎ¨∏ */}
          {data.flowerEnabled && data.selectedFlowerVendors.length > 0 && (
            <div className="space-y-2">
              <p className="text-sm font-medium text-gray-700">ÌôîÌôò Ï£ºÎ¨∏</p>
              <div className="rounded bg-gray-50 p-2 text-center text-xs">
                <p>ÌôîÌôò Ï£ºÎ¨∏Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§</p>
                <p className="mt-1 text-gray-500">
                  {data.selectedFlowerVendors.length}Í∞ú ÏóÖÏ≤¥ Ïó∞Í≤∞
                </p>
              </div>
            </div>
          )}

          {/* ÎßàÏßÄÎßâ Î©îÏãúÏßÄ */}
          {data.endingMessage && (
            <div className="pt-4 text-center text-sm text-gray-600">
              {data.endingMessage.split("\n").map((line, index) => (
                <p key={index}>{line}</p>
              ))}
              <p className="mt-2 text-xs text-gray-400">Ìö®Í≥º: {data.endingMessageEffect}</p>
            </div>
          )}

          {/* Ïª§Ïä§ÌÖÄ URL */}
          {data.customUrl && (
            <div className="pt-2 text-center text-xs text-gray-500">URL: {data.customUrl}</div>
          )}
        </div>
      </div>
    </div>
  );
}
